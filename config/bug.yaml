---
pipeline:
  processors:
    - bloblang: |
        root.body = "{\"data\":\"TODO\"}"
        root.statusCode = 200
    - branch:
        result_map: 'tmp.res_bytes = content()'
        processors:
          - resource: worker_lambda
    - log:
        message: 'Error: ${! error() }'

output:
  switch:
    cases:
      - check: errored()
        output:
          reject: ${! error() }
      - output:
          sync_response: {}

resources:
  processors:
    worker_lambda:
      aws_lambda:
        region: ${AWS_REGION}
        function: ${WORKER_LAMBDA:'null'}

logger:
  level: ${LOG_LEVEL:info}
  static_fields:
    functionName: ${AWS_LAMBDA_FUNCTION_NAME:''}
    version: ${LOG_VERSION:''}
